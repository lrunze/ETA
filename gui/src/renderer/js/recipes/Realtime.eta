{"vi_templatejg59migx":"{\"nodes\":[{\"x\":152,\"y\":120,\"fixed\":true,\"text\":\"a\",\"px\":152,\"py\":120,\"initial\":true}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"1\"}],\"usercode\":\"a:\\n    emit(3,0)# here, ch1 is duplicated to ch3 with a delay of 0ps\"}","vi_templatejfc9koma":"{\"nodes\":[{\"x\":82,\"y\":81,\"fixed\":true,\"text\":\"a\",\"px\":82,\"py\":81,\"initial\":true}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"0\"}],\"usercode\":\"a:\\n    emit(2,0)# here, ch0 is duplicated to ch2 with a delay of 0ps\"}","vi_templatejg52ksbp":"{\"nodes\":[{\"x\":374,\"y\":109,\"fixed\":true,\"text\":\"start\",\"px\":374,\"py\":109},{\"x\":101,\"y\":103,\"fixed\":true,\"text\":\"stop\",\"px\":101,\"py\":103,\"initial\":true}],\"edges\":[{\"source\":0,\"target\":1,\"text\":\"3\"},{\"source\":1,\"target\":0,\"text\":\"2\"},{\"source\":0,\"target\":0,\"text\":\"2\"},{\"source\":1,\"target\":1,\"text\":\"3\"}],\"usercode\":\"HISTOGRAM(h3,(`bins`,`binsize`))\\nINTEGER(i1,0)\\nCLOCK(c3,100,1)\\nstart:\\n    {i1+=AbsTime_ps}\\n    c3.start()\\n\\nstop:\\n    c3.stop()\\n    h3.record(c3)\\n\"}","vi_templatejfb2qshf":"{\"nodes\":[{\"x\":346,\"y\":111,\"fixed\":true,\"text\":\"start\",\"px\":346,\"py\":111},{\"x\":75,\"y\":66,\"fixed\":true,\"text\":\"stop\",\"px\":75,\"py\":66,\"initial\":true}],\"edges\":[{\"source\":0,\"target\":1,\"text\":\"2\"},{\"source\":1,\"target\":0,\"text\":\"3\"},{\"source\":0,\"target\":0,\"text\":\"3\"},{\"source\":1,\"target\":1,\"text\":\"2\"}],\"usercode\":\"HISTOGRAM(h4,(`bins`,`binsize`))\\nCLOCK(c4,100,1)\\nstart:\\n    c4.start()\\nstop:\\n    c4.stop()\\n    h4.record(c4)\"}","eta_index_table":"[{\"id\":\"var_templatejgmgopco\",\"name\":\"file\",\"group\":\"main\",\"info\":\"\",\"config\":\"C:/YourFolder/YourFile.timetag\"},{\"id\":\"var_templatejkil6yh0\",\"name\":\"expname\",\"group\":\"main\",\"info\":\"\",\"config\":\"Realtime\"},{\"id\":\"var_templatejkil9dn6\",\"name\":\"binsize\",\"group\":\"main\",\"info\":\"\",\"config\":\"16\"},{\"id\":\"var_templatejkil8r7x\",\"name\":\"bins\",\"group\":\"main\",\"info\":\"\",\"config\":\"10000\"},{\"id\":\"var_templatejkil7pz1\",\"name\":\"start_from_beginning\",\"group\":\"main\",\"info\":\"\",\"config\":\"1\"},{\"id\":\"var_templatejmm3pmye\",\"name\":\"records_per_cut\",\"group\":\"main\",\"info\":\"\",\"config\":\"20000\"},{\"id\":\"dpp_templatejmm36p57\",\"name\":\"realtime\",\"group\":\"main\",\"info\":\"\",\"config\":\"\"},{\"id\":\"ri_templatejezi0bbr\",\"name\":\"TimeTagger\",\"group\":\"main\",\"info\":\"游닋 [0, 1]\",\"config\":\"[2,0]\"},{\"id\":\"vi_templatejfc9koma\",\"name\":\"DL0-2\",\"group\":\"main\",\"info\":\"游닌 [0], 游닋 [2], 游늵 ??? \",\"config\":\"\"},{\"id\":\"vi_templatejg59migx\",\"name\":\"DL1-3\",\"group\":\"main\",\"info\":\"游닌 [1], 游닋 [3], 游늵 ??? \",\"config\":\"\"},{\"id\":\"vi_templatejg52ksbp\",\"name\":\"Correlationbwd\",\"group\":\"main\",\"info\":\"游닌 [3, 2], 游닋 [], 游늵 ??? \",\"config\":\"\"},{\"id\":\"vi_templatejfb2qshf\",\"name\":\"Correlationfwd\",\"group\":\"main\",\"info\":\"游닌 [2, 3], 游닋 [], 游늵 ??? \",\"config\":\"\"}]","var_templatejkil6yh0":null,"var_templatejkil7pz1":null,"var_templatejkil8r7x":null,"var_templatejkil9dn6":null,"dpp_templatejmm36p57":"#------IMPORTS-----\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\nfrom os import path\r\nfrom matplotlib.widgets import Button\r\nimport time\r\n\r\n\r\n#-----PLOTTING----\r\nplt.ion()\r\nfig, ax = plt.subplots()\r\nplt.subplots_adjust(bottom=0.2)\r\nline1, = ax.plot([], [], 'r-') # Returns a tuple of line objects, thus the comma\r\nax.set_ylabel('Histogram events')\r\nax.set_xlabel('Time delay (ps)')\r\nax.set_title(expname)\r\nfirst_run = True # for setting the axis\r\n\r\n#-----BUTTONS----\r\ndata_last=None\r\ndata_now=None\r\ndef clear_graph(event): #clears the graph\r\n    global data_last\r\n    global data_now\r\n    global np\r\n    data_last=np.copy(data_now)\r\n    \r\nbase=None\r\ndef mode(event): #switches between alignment mode and accumulation mode\r\n    global base, ctx1, y_max\r\n    y_max = 1\r\n    if base == None:\r\n        base = ctx1\r\n    else:\r\n        base = None\r\n\r\nlog = False\r\ny_min = 0\r\ny_max = 1\r\ndef linlog(event): #switches between log and linear scale for the y axis\r\n        global ax, plt, log, y_min\r\n        if log==True:\r\n            ax.set_yscale(\"linear\")\r\n            log=False\r\n            y_min=0\r\n        else:\r\n            ax.set_yscale(\"log\", nonposy='clip')\r\n            log=True\r\n            y_min=0.5\r\n\r\n\r\naxmode = plt.axes([0.7, 0.05, 0.1, 0.075])\r\naxlinlog = plt.axes([0.81, 0.05, 0.1, 0.075])\r\nblinlog = Button(axlinlog, 'Lin/Log')\r\nbmode = Button(axmode, 'Mode')\r\nblinlog.on_clicked(linlog)\r\nbmode.on_clicked(mode)\r\n\r\n#------ETA PROCESSING-----\r\nrecords_per_cut = int(records_per_cut)\r\nbinsize=int(binsize)\r\nstart_from_beginning = int(start_from_beginning)\r\nrec_per_cut_estimator_probing_mode = 1 # switches to upward probing in the beginning\r\nif start_from_beginning>0:\r\n   cut = None\r\n   rec_per_cut_estimator_probing_mode = 0 # disable probing\r\nelse:\r\n   cut = eta.simple_cut(file,format=0) # skip to the end of file\r\nctx1=None\r\neta.send(\"ETA is running in realtime...\", \"running\")\r\n\r\nwhile True:\r\n    records_per_cut= int(records_per_cut) # make it an integer \r\n    print(\"records_per_cut: \"+str(records_per_cut))\r\n    try:\r\n        cut=eta.incremental_cut(file,cut=cut, rec_per_cut=records_per_cut,format=0,verbose=False)\r\n    except Exception as e:\r\n        eta.send(str(e),\"err\")\r\n        break\r\n    \r\n    #------automatic records_per_cut estimator------\r\n    starttime = time.time()\r\n    if not(eta.wait_till_presnese(cut,timeout=1.0)):\r\n        break\r\n    waitingelapsed = time.time() - starttime\r\n    if rec_per_cut_estimator_probing_mode==1:\r\n        print(\"probing upward...\")\r\n        if waitingelapsed<0.1: #if there is no extra wating for data\r\n            records_per_cut*=1.3 # incremese rec_per_cut\r\n        else:\r\n            rec_per_cut_estimator_probing_mode=-1 # switches to downward probing\r\n    elif rec_per_cut_estimator_probing_mode==-1:\r\n        print(\"probing downward...\")\r\n        if waitingelapsed>0.1:\r\n            records_per_cut*=0.7 # decrease rec_per_cut\r\n        else:\r\n            rec_per_cut_estimator_probing_mode=0 # stop probing \r\n    else:\r\n        print(\"Not in probing mode\")\r\n        print(waitingelapsed)\r\n    \r\n     #------end of automatic records_per_cut estimator------\r\n     \r\n    result,ctx1 = eta.run(cut, group='main',\r\n       ctxs= base,sum_results=True,iterate_ctxs=True,verbose=False)\r\n    \r\n    t1=result[\"h3\"]\r\n    t2=result[\"h4\"] \r\n    \r\n    if first_run:\r\n        base=ctx1\r\n        ax.set_xlim(-t2.size*binsize,t1.size*binsize)\r\n        first_run = False\r\n    data_now=np.copy(np.concatenate((np.flip(t2, 0), t1), axis=0))\r\n    if data_last is not None:\r\n        data_draw=data_now-data_last\r\n    else:\r\n        data_draw=data_now\r\n    try:\r\n        if np.amax(data_draw)>=y_max*0.95:\r\n            y_max=np.amax(data_draw)*3\r\n        ax.set_ylim(y_min,y_max)\r\n        line1.set_xdata(np.arange(-t2.size,t1.size)*binsize)\r\n        line1.set_ydata(data_draw)\r\n        fig.canvas.draw()\r\n        fig.canvas.flush_events()\r\n    except Exception as e:\r\n        #eta.send(str(e),\"err\")\r\n        break\r\neta.send(\"ETA realtime is stopped.\", \"stopped\")\r\nplt.close()","var_templatejmm3pmye":null}
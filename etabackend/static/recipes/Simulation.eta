{"eta_index_table":"[{\"id\":\"var_templatejkim8w21\",\"name\":\"binsize\",\"group\":\"main\",\"info\":\"\",\"config\":\"16\"},{\"id\":\"var_templatek5wr10m4\",\"name\":\"bins\",\"group\":\"main\",\"info\":\"\",\"config\":\"10000\"},{\"id\":\"var_templatek627u266\",\"name\":\"ETA_VERSION\",\"group\":\"main\",\"info\":\"\",\"config\":\"0.7.4\"},{\"id\":\"var_templatek8oniclt\",\"name\":\"savefile\",\"group\":\"main\",\"info\":\"\",\"config\":\"C:/YourFolder/YourFile.txt\"},{\"id\":\"var_templatek8otc7cm\",\"name\":\"generation_efficiency\",\"group\":\"main\",\"info\":\"\",\"config\":\"1\"},{\"id\":\"var_templatek8otdk2b\",\"name\":\"detection_efficiency_XX\",\"group\":\"main\",\"info\":\"\",\"config\":\"1\"},{\"id\":\"var_templatek8otdo36\",\"name\":\"detection_efficiency_X\",\"group\":\"main\",\"info\":\"\",\"config\":\"1\"},{\"id\":\"var_templatek8pi708a\",\"name\":\"syncs\",\"group\":\"main\",\"info\":\"\",\"config\":\"300000\"},{\"id\":\"dpp_templatek0e4fe69\",\"name\":\"display\",\"group\":\"main\",\"info\":\"\",\"config\":\"\"},{\"id\":\"dpp_templatek0e4ffk5\",\"name\":\"create txt\",\"group\":\"main\",\"info\":\"\",\"config\":\"\"},{\"id\":\"vi_templatek8phyqso\",\"name\":\"oscillating generator\",\"group\":\"main\",\"info\":\"游닌[0, 42] 游닋[0, 42] \",\"config\":\"\"},{\"id\":\"vi_templatek8oikos6\",\"name\":\"generation losses\",\"group\":\"main\",\"info\":\"游닌[0] 游닋[1, 2] \",\"config\":\"\"},{\"id\":\"vi_templatek5wjumx9\",\"name\":\"QD\",\"group\":\"main\",\"info\":\"游닌[4, 5, 1, 3] 游닋[3, 4, 5] \",\"config\":\"\"},{\"id\":\"vi_templatek8oikwhw\",\"name\":\"detection losses XX\",\"group\":\"main\",\"info\":\"游닌[4] 游닋[6, 7] \",\"config\":\"\"},{\"id\":\"vi_templatek8oize34\",\"name\":\"detection losses X\",\"group\":\"main\",\"info\":\"游닌[5] 游닋[8, 9] \",\"config\":\"\"},{\"id\":\"vi_templatek8oid9rt\",\"name\":\"X-XX splitter (alternative to beam splitter)\",\"group\":\"disabled\",\"info\":\"游닌[6, 8] 游닋[10, 11] \",\"config\":\"\"},{\"id\":\"vi_templatek5wotz9c\",\"name\":\"beam splitter (alternative to X-XX splitter)\",\"group\":\"main\",\"info\":\"游닌[6, 8] 游닋[10, 11] \",\"config\":\"\"},{\"id\":\"vi_templatek8pymwel\",\"name\":\"Delay 10-12\",\"group\":\"main\",\"info\":\"游닌[10] 游닋[12] \",\"config\":\"\"},{\"id\":\"vi_templatek8pynxw8\",\"name\":\"Delay 11-13\",\"group\":\"main\",\"info\":\"游닌[11] 游닋[13] \",\"config\":\"\"},{\"id\":\"vi_templatek0e3qybt\",\"name\":\"Correlationbwd\",\"group\":\"main\",\"info\":\"游닌[12, 13] \",\"config\":\"\"},{\"id\":\"vi_templatek0e3sowi\",\"name\":\"Correlationfwd\",\"group\":\"main\",\"info\":\"游닌[13, 12] \",\"config\":\"\"}]","var_templatejkim8w21":null,"vi_templatek0e3qybt":"{\"nodes\":[{\"x\":346,\"y\":111,\"fixed\":true,\"text\":\"start\",\"px\":346,\"py\":111},{\"x\":75,\"y\":86,\"fixed\":true,\"text\":\"stop\",\"px\":75,\"py\":86,\"initial\":true}],\"edges\":[{\"source\":0,\"target\":1,\"text\":\"12\"},{\"source\":1,\"target\":0,\"text\":\"13\"},{\"source\":0,\"target\":0,\"text\":\"13\"},{\"source\":1,\"target\":1,\"text\":\"12\"}],\"usercode\":\"HISTOGRAM(h2,(`bins`,`binsize`,\\\"time-1\\\"))\\nHISTOGRAM(h2_zero,(1,1))\\nCLOCK(c2,10000,1)\\nstart:\\n    c2.start()\\nstop:\\n    c2.stop()\\n    h2.record_all(c2)\\n    h2_zero.record_all(c2)\"}","vi_templatek0e3sowi":"{\"nodes\":[{\"x\":346,\"y\":111,\"fixed\":true,\"text\":\"start\",\"px\":346,\"py\":111},{\"x\":76,\"y\":88,\"fixed\":true,\"text\":\"stop\",\"px\":76,\"py\":88,\"initial\":true}],\"edges\":[{\"source\":0,\"target\":1,\"text\":\"13\"},{\"source\":1,\"target\":0,\"text\":\"12\"},{\"source\":0,\"target\":0,\"text\":\"12\"},{\"source\":1,\"target\":1,\"text\":\"13\"}],\"usercode\":\"HISTOGRAM(h1,(`bins`,`binsize`))\\nCLOCK(c1,10000,1)\\nstart:\\n    c1.start()\\nstop:\\n    c1.stop()\\n    h1.record_all(c1)\"}","dpp_templatek0e4fe69":"#------IMPORTS-----\r\n\r\nimport numpy as np\r\nimport pandas as pd\r\nfrom pathlib import Path\r\nfrom bokeh.layouts import column, row\r\nfrom bokeh.models import ColumnDataSource, Slider, Range1d\r\nfrom bokeh.models.tools import HoverTool\r\nfrom bokeh.plotting import figure\r\nfrom bokeh.server.server import Server\r\nfrom bokeh.themes import Theme\r\nfrom bokeh.models.widgets import Tabs, Panel, Button\r\n\r\n\r\n#------ETA PROCESSING-----\r\n\r\nresult= eta.run(None, group='main', stop_with_source=False)\r\nhist1=result[\"h1\"]\r\nhist2=result[\"h2\"]\r\nhist0=result[\"h2_zero\"]\r\nhist1[0]+= hist0[0]\r\n\r\nfullhist=np.concatenate((hist2[::-1],hist1))\r\nxdata = np.arange(-hist2.size,hist1.size)*int(float(binsize))\r\n\r\nf=Path(savefile)\r\nLABEL = 'simulation'\r\n\r\n\r\n#------PLOTTING-----\r\n\r\ndf = pd.DataFrame(np.vstack((xdata, fullhist)).T, \r\n                  columns=['time bins', 'histogram events'])\r\ndf['log events'] = np.clip(df['histogram events'].values, 0.5, None)\r\n\r\n\r\ndef generate_doc(doc):\r\n    source = ColumnDataSource(df)\r\n    \r\n    def info(file_index):\r\n        return (f'Created with ETA - https://timetag.github.io\\n'\r\n            f'filename: {f.stem}_{LABEL}_{file_index:0=3d}{f.suffix}\\n'\r\n            f'binsize: {binsize}\\n'\r\n            f'bins: {bins}\\n'\r\n            f'syncs: {syncs}\\n'\r\n            )\r\n    \r\n    def style(p):\r\n        # Title \r\n        p.title.text = 'Correlation'\r\n        p.title.align = 'center'\r\n        p.title.text_font_size = '20pt'\r\n        p.title.text_font = 'serif'\r\n\r\n        # Axis titles\r\n        p.xaxis.axis_label = 'Time delay (ps)'\r\n        p.xaxis.axis_label_text_font_size = '14pt'\r\n        p.xaxis.axis_label_text_font_style = 'bold'\r\n        p.yaxis.axis_label = 'Histogram events'\r\n        p.yaxis.axis_label_text_font_size = '14pt'\r\n        p.yaxis.axis_label_text_font_style = 'bold'\r\n\r\n        # Tick labels\r\n        p.xaxis.major_label_text_font_size = '12pt'\r\n        p.yaxis.major_label_text_font_size = '12pt'\r\n        \r\n        # limit data range\r\n        p.x_range = Range1d(-hist2.size*int(float(binsize)), hist1.size*int(float(binsize)))\r\n        \r\n        \r\n        # remove padding\r\n        p.min_border_bottom = 0\r\n        p.min_border_left = 0\r\n        \r\n        # legend\r\n        p.legend.location = \"top_right\"\r\n        p.legend.click_policy=\"hide\"\r\n        \r\n        return p\r\n\r\n    def bokeh_button_save_callback():\r\n        global LABEL\r\n        f.parent.mkdir(parents=True, exist_ok=True)  # Create analyzed folder\r\n\r\n        file_index = 0\r\n        # create unique index for file\r\n        while f.parent.joinpath(f\"{f.stem}_{LABEL}_{file_index:0=3d}{f.suffix}\").exists():\r\n            file_index += 1\r\n\r\n        np.savetxt(f.parent.joinpath(f\"{f.stem}_{LABEL}_{file_index:0=3d}{f.suffix}\"),\r\n                           np.transpose([xdata, fullhist]), delimiter='\\t', header=info(file_index))\r\n\r\n    def make_plot(src):\r\n        \r\n        button_save = Button(label=\"Save\")\r\n        button_save.on_click(bokeh_button_save_callback)\r\n        save_button = row(button_save, sizing_mode='stretch_width')\r\n        # tools setup\r\n        hover=HoverTool(tooltips = [\r\n                    (\"Delay: \", \"@{time bins}\"),\r\n                    (\"Histogram events: \", \"@{histogram events}\"),\r\n                    ],\r\n                    mode='vline', point_policy = \"snap_to_data\",\r\n                    line_policy = \"nearest\"\r\n                )\r\n        toolbox = \"pan,wheel_zoom,box_zoom,reset\"\r\n        # linear plot setup\r\n        plin = figure(plot_width = 700, plot_height = 700,\r\n                   y_axis_type='linear', tools=toolbox,\r\n                    #active_drag=\"box_zoom\",\r\n                   active_scroll='wheel_zoom')\r\n        plin.y_range = Range1d(0.5, df['histogram events'].max(axis=0)*1.1)\r\n        plin.add_tools(hover)\r\n        plin.line(x='time bins', y='log events', \r\n                  source=src, color='firebrick', legend_label='Correlation', line_width=1.5\r\n                 )\r\n        # log plot setup\r\n        plog = figure(plot_width = 700, plot_height = 700,\r\n                      y_axis_type='log', tools=toolbox,\r\n                      #active_drag=\"box_zoom\",\r\n                      active_scroll='wheel_zoom')\r\n        plog.y_range = Range1d(0, df['histogram events'].max(axis=0)*1.1)\r\n        plog.y_range = Range1d(0.5, df['histogram events'].max(axis=0)*1.1)\r\n        plog.add_tools(hover)\r\n        plog.line(x='time bins', y='log events', \r\n               source=src, color='firebrick', legend_label='Correlation', line_width=1.5\r\n              )\r\n        plog.x_range = plin.x_range\r\n        # Styling\r\n        plin = style(plin)\r\n        plog = style(plog)\r\n        \r\n        panellin = Panel(child=column([plin,save_button], sizing_mode='stretch_both'), title=\"Linear\")\r\n        panellog = Panel(child=column([plog,save_button], sizing_mode='stretch_both'), title=\"Log\")\r\n        \r\n        return [panellin, panellog]\r\n\r\n    panels = make_plot(source)\r\n    tabs = Tabs(tabs=panels)\r\n    doc.add_root(tabs)\r\n    \r\n    return doc\r\n\r\neta.display(generate_doc, 'bokeh')","dpp_templatek0e4ffk5":"#------IMPORTS-----\r\nfrom pathlib import Path\r\nimport numpy as np\r\n\r\ndef info(filename, binsize=binsize, bins=bins):\r\n    return (f'Created with ETA - https://timetag.github.io\\n'\r\n            f'filename: {filename.name}\\n'\r\n            f'binsize: {binsize}\\n'\r\n            f'bins: {bins}\\n'\r\n            )\r\n\r\n#------ETA PROCESSING-----\r\nbinsize=int(float(binsize))\r\nf=Path(savefile)\r\n\r\nresult=eta.run(None, group='main')\r\nhist1=result[\"h1\"]\r\nhist2=result[\"h2\"]\r\nhist0=result[\"h2_zero\"]\r\nhist1[0]+= hist0[0]\r\n\r\nfullhist=np.concatenate((hist2[::-1],hist1))\r\nf.parent.mkdir(parents=True, exist_ok=True)\r\nnp.savetxt(f.parent.joinpath(f.stem + '.txt'), np.transpose([np.arange(-hist2.size,hist1.size)*binsize,fullhist]), delimiter='\\t', header=info(f))\r\neta.send(str(f.name) + ' has been successfully processed')\r\neta.send('FINISHED')","vi_templatek5wjumx9":"{\"nodes\":[{\"x\":200,\"y\":326,\"fixed\":true,\"text\":\"g\",\"initial\":true,\"px\":200,\"py\":326},{\"x\":285,\"y\":86,\"weight\":1,\"fixed\":true,\"text\":\"XX\",\"px\":285,\"py\":86},{\"x\":320,\"y\":220,\"weight\":1,\"fixed\":true,\"px\":320,\"py\":220,\"text\":\"X\"},{\"x\":197,\"y\":50,\"weight\":1,\"fixed\":true,\"text\":\"above\",\"px\":197,\"py\":50}],\"edges\":[{\"source\":1,\"target\":2,\"text\":\"4\"},{\"source\":2,\"target\":0,\"text\":\"5\"},{\"source\":0,\"target\":3,\"text\":\"1\"},{\"source\":3,\"target\":1,\"text\":\"3\"}],\"usercode\":\"INTEGER(feeding_delay)\\nINTEGER(xx_delay)\\nINTEGER(x_delay)\\n\\nabove:\\n    {\\n        binsize = 16\\n        feeding_delay_arr = ((np.random.exponential(0, 1))/binsize)\\n        feeding_delay = round(feeding_delay_arr[0])*binsize \\n    }\\n    emit(3,feeding_delay)\\n    \\nXX:\\n    {\\n        binsize = 16\\n        xx_delay_arr = ((np.random.exponential(125, 1))/binsize)\\n        xx_delay = round(xx_delay_arr[0])*binsize\\n    }\\n    emit(4,xx_delay)\\n\\nX:\\n    {\\n        binsize = 16\\n        x_delay_arr = ((np.random.exponential(250, 1))/binsize)\\n        x_delay = round(x_delay_arr[0])*binsize\\n    }\\n    emit(5,x_delay)\"}","vi_templatek5wotz9c":"{\"nodes\":[{\"x\":137,\"y\":114,\"fixed\":true,\"initial\":true,\"text\":\"a\",\"px\":137,\"py\":114}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"6,8\"}],\"usercode\":\"VFILE(10)\\nVFILE(11)\\nINTEGER(retchn)\\n\\na--6-->a:\\n    {\\n        options = np.asarray([10,11])\\n        retchn = np.random.choice(options)\\n    }\\n    emit(retchn,0)\"}","var_templatek5wr10m4":null,"var_templatek627u266":null,"vi_templatek8oid9rt":"{\"nodes\":[{\"x\":137,\"y\":114,\"fixed\":true,\"initial\":true,\"text\":\"a\",\"px\":137,\"py\":114}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"6,8\"}],\"usercode\":\"VFILE(10)\\nVFILE(11)\\n\\na--6-->a:\\n    emit(10,0)\\n\\na--8-->a:\\n    emit(11,0)\"}","vi_templatek8oikos6":"{\"nodes\":[{\"x\":215,\"y\":133,\"fixed\":true,\"initial\":true,\"text\":\"a\"}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"0\"}],\"usercode\":\"VFILE(1)\\nVFILE(2)\\nINTEGER(lossy_s)\\na:\\n    {   \\n        g_losses_s=1-`generation_efficiency`\\n        options1 = np.asarray([1,2])\\n        lossy_s = options1[np.searchsorted(np.cumsum(\\n            np.asarray([1-g_losses_s,g_losses_s])\\n            ), np.random.random(), side=\\\"right\\\")]\\n    }\\n    emit(lossy_s,0)\"}","vi_templatek8oikwhw":"{\"nodes\":[{\"x\":222,\"y\":100,\"fixed\":true,\"initial\":true,\"text\":\"a\"}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"4\"}],\"usercode\":\"VFILE(6)\\nVFILE(7)\\nINTEGER(lossy_xx)\\na:\\n    {\\n        d_losses_xx=1-`detection_efficiency_XX`\\n        options2 = np.asarray([6,7])\\n        lossy_xx = options2[np.searchsorted(np.cumsum(\\n            np.asarray([1-d_losses_xx,d_losses_xx])\\n            ), np.random.random(), side=\\\"right\\\")]\\n    }\\n    emit(lossy_xx,0)\"}","vi_templatek8oize34":"{\"nodes\":[{\"x\":222,\"y\":100,\"fixed\":true,\"initial\":true,\"text\":\"a\"}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"5\"}],\"usercode\":\"VFILE(8)\\nVFILE(9)\\nINTEGER(lossy_x)\\na:\\n    {\\n        d_losses_x = 1-`detection_efficiency_X`\\n        options3 = np.asarray([8,9])\\n        lossy_x = options3[np.searchsorted(\\n            np.cumsum(np.asarray([1-d_losses_x,d_losses_x])\\n            ), np.random.random(), side=\\\"right\\\")]\\n    }\\n    emit(lossy_x,0)\"}","var_templatek8oniclt":null,"var_templatek8otc7cm":null,"var_templatek8otdk2b":null,"var_templatek8otdo36":null,"vi_templatek8phyqso":"{\"nodes\":[{\"x\":225,\"y\":95,\"fixed\":true,\"initial\":true,\"text\":\"a\",\"px\":225,\"py\":95},{\"x\":293,\"y\":190,\"weight\":1,\"fixed\":true,\"text\":\"done\"}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"0\"},{\"source\":0,\"target\":1,\"text\":\"42\"}],\"usercode\":\"INTEGER(sync_counter)\\nINTEGER(conditional)\\nemit(0,12500)\\n\\n\\na:\\n    {\\n        sync_counter+=1\\n        conditional=int(sync_counter>=`syncs`)\\n    }\\n    emit(42,0,0,conditional)\\n    emit(0,12500)\\n    \\ndone:\\n    abort()\"}","var_templatek8pi708a":null,"vi_templatek8pymwel":"{\"nodes\":[{\"x\":185,\"y\":135,\"fixed\":true,\"initial\":true,\"text\":\"a\"}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"10\"}],\"usercode\":\"a:\\n    emit(12,0)\\n\"}","vi_templatek8pynxw8":"{\"nodes\":[{\"x\":185,\"y\":135,\"fixed\":true,\"initial\":true,\"text\":\"a\"}],\"edges\":[{\"source\":0,\"target\":0,\"text\":\"11\"}],\"usercode\":\"a:\\n    emit(13,0)\"}"}